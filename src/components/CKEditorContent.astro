---
import { processHtmlContent } from "@utils/html-processor";

interface Props {
  content: string;
  processed?: boolean;
}

const { content, processed = false } = Astro.props;
const processedHtml = processed ? content : await processHtmlContent(content);
---

<div class="prose-ckeditor ckeditor-content">
  <Fragment set:html={processedHtml} />
</div>

<script>
  function initCodeBlockCopy() {
    const copyButtons = document.querySelectorAll(".code-block-copy");

    copyButtons.forEach((button) => {
      button.addEventListener("click", async () => {
        const code = button.getAttribute("data-code");
        if (!code) return;

        try {
          await navigator.clipboard.writeText(code);

          // Toggle icons
          const copyIcon = button.querySelector(".icon-copy");
          const checkIcon = button.querySelector(".icon-check");

          if (copyIcon && checkIcon) {
            copyIcon.classList.add("hidden");
            checkIcon.classList.remove("hidden");

            // Reset after 2 seconds
            setTimeout(() => {
              copyIcon.classList.remove("hidden");
              checkIcon.classList.add("hidden");
            }, 2000);
          }
        } catch (err) {
          console.error("Failed to copy code:", err);
        }
      });
    });
  }

  // Initialize on page load
  initCodeBlockCopy();

  // Re-initialize on Astro page transitions
  document.addEventListener("astro:page-load", initCodeBlockCopy);
</script>
